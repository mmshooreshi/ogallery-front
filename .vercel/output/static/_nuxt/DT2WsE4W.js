import{f as A,r as f,k as $,j as E,A as I,c as r,o as c,a as s,e as S,t as g,B as D,C as Y,m as o,D as L,F as C,v as M,b as y,w as T,_ as N}from"#entry";import{u as R}from"./D2xXEtf8.js";const U=d=>$fetch(`/api/admin/${d}`),j=(d,n)=>$fetch(`/api/admin/${d}`,{method:"PUT",body:n}),F=(d,n)=>$fetch(`/api/admin/${d}/${encodeURIComponent(n)}`,{method:"DELETE"}),O=()=>$fetch("/api/admin/export"),V=d=>d.text().then(n=>$fetch("/api/admin/import",{method:"POST",body:n,headers:{"Content-Type":"application/json"}})),B={class:"border rounded-2xl p-4 shadow"},P={class:"flex items-center justify-between mb-3"},J={class:"font-semibold"},q={class:"flex gap-2"},W={key:0,class:"text-sm opacity-70"},z={key:1,class:"text-sm text-red-600"},G={class:"cursor-pointer px-3 py-2 flex items-center justify-between"},H={class:"font-medium"},K={class:"opacity-60"},Q={class:"p-3 grid gap-2"},X={class:"text-xs opacity-70"},Z=["onUpdate:modelValue"],ee=["onUpdate:modelValue"],te={class:"flex gap-2 mt-2"},le=["onClick"],se=["onClick"],ae={key:2,class:"text-sm opacity-70"},oe=A({__name:"AdminEditor",props:{title:{},collection:{},fields:{}},setup(d){const n=d,u=f([]),i=f({}),m=f(""),b=f(!1),p=f(null);async function k(){b.value=!0,p.value=null;try{const t=await U(n.collection);u.value=Array.isArray(t)?t:[]}catch(t){p.value=t?.message||"Failed to load",u.value=[]}finally{b.value=!1}}$(()=>{k(),window.addEventListener("storage",t=>{(!t.key||t.key.includes(n.collection))&&k()})}),E(u,t=>{if(Array.isArray(t))for(const l of t)l?.slug&&!i.value[l.slug]&&(i.value[l.slug]={...l})},{immediate:!0,deep:!1});const x=I(()=>{const t=m.value.toLowerCase().trim(),l=Array.isArray(u.value)?u.value:[];return t?l.filter(e=>String(e?.slug||"").toLowerCase().includes(t)||String(e?.title||e?.name||"").toLowerCase().includes(t)):l});function h(){const t=prompt("New item slug (unique, URL-safe):")?.trim();if(!t)return;const l={slug:t};for(const e of n.fields)e.key in l||(l[e.key]="");u.value=[...u.value,l],i.value[t]={...l}}async function v(t){const l=i.value[t];if(!l?.slug)return alert("Missing slug");await j(n.collection,l),await k()}async function w(t){confirm("Delete item?")&&(await F(n.collection,t),await k(),delete i.value[t])}return(t,l)=>(c(),r("div",B,[s("header",P,[s("h2",J,g(t.title),1),s("div",q,[D(s("input",{"onUpdate:modelValue":l[0]||(l[0]=e=>L(m)?m.value=e:null),placeholder:"Search by slug/title",class:"border rounded px-2 py-1"},null,512),[[Y,o(m)]]),s("button",{onClick:h,class:"border rounded px-2 py-1"},"+ New")])]),o(b)?(c(),r("p",W,"Loading…")):o(p)?(c(),r("p",z,g(o(p)),1)):S("",!0),(c(!0),r(C,null,M(o(x),e=>(c(),r("details",{key:e.slug,class:"mb-2 rounded border"},[s("summary",G,[s("span",H,g(e.title||e.name||e.slug),1),s("small",K,"/"+g(t.collection)+"/"+g(e.slug),1)]),s("div",Q,[(c(!0),r(C,null,M(t.fields,a=>(c(),r("div",{key:a.key,class:"grid gap-1"},[s("label",X,g(a.label),1),a.textarea?D((c(),r("textarea",{key:0,"onUpdate:modelValue":_=>o(i)[e.slug][a.key]=_,rows:"4",class:"border rounded px-2 py-1"},null,8,Z)),[[Y,o(i)[e.slug][a.key]]]):D((c(),r("input",{key:1,"onUpdate:modelValue":_=>o(i)[e.slug][a.key]=_,class:"border rounded px-2 py-1"},null,8,ee)),[[Y,o(i)[e.slug][a.key]]])]))),128)),s("div",te,[s("button",{onClick:a=>v(e.slug),class:"border rounded px-3 py-1"},"Save",8,le),s("button",{onClick:a=>w(e.slug),class:"border rounded px-3 py-1"},"Delete",8,se)])])]))),128)),!o(b)&&!o(p)&&!o(x).length?(c(),r("p",ae,"No items yet.")):S("",!0)]))}}),ne=Object.assign(oe,{__name:"AdminEditor"}),ie={class:"min-h-screen p-6"},re={class:"flex items-center justify-between mb-6"},ce={class:"flex gap-2"},de={class:"grid md:grid-cols-2 lg:grid-cols-3 gap-6"},pe=A({__name:"index",setup(d){const{logout:n}=R(),u=f(null);async function i(){const t=await O(),l=new Blob([t],{type:"application/json"}),e=URL.createObjectURL(l),a=document.createElement("a");a.href=e,a.download="content-export.json",a.click(),URL.revokeObjectURL(e)}async function m(t){const e=t.target.files?.[0];e&&(await V(e),alert("Imported successfully. Reloading…"),location.reload())}const b=[{key:"slug",label:"Slug"},{key:"name",label:"Name"},{key:"bio",label:"Biography",textarea:!0},{key:"image",label:"Image URL"},{key:"website",label:"Website"}],p=[{key:"slug",label:"Slug"},{key:"title",label:"Title"},{key:"artists",label:"Artists (comma-separated)"},{key:"startDate",label:"Start Date (YYYY-MM-DD)"},{key:"endDate",label:"End Date (YYYY-MM-DD)"},{key:"status",label:"Status (current|upcoming|past)"},{key:"year",label:"Year"},{key:"pressRelease",label:"Press Release",textarea:!0},{key:"images",label:"Images (comma-separated)"}],k=[{key:"slug",label:"Slug"},{key:"title",label:"Title"},{key:"startDate",label:"Start Date (YYYY-MM-DD)"},{key:"endDate",label:"End Date (YYYY-MM-DD)"},{key:"press",label:"Press Note",textarea:!0},{key:"images",label:"Images (comma-separated)"}],x=[{key:"slug",label:"Slug"},{key:"title",label:"Title"},{key:"artist",label:"Artist"},{key:"startDate",label:"Start Date (YYYY-MM-DD)"},{key:"endDate",label:"End Date (YYYY-MM-DD)"},{key:"text",label:"Curatorial Text",textarea:!0},{key:"images",label:"Images (comma-separated)"}],h=[{key:"slug",label:"Slug"},{key:"title",label:"Title"},{key:"date",label:"Date (YYYY-MM-DD)"},{key:"summary",label:"Summary",textarea:!0},{key:"coverImage",label:"Cover Image"},{key:"body",label:"Body (Markdown)",textarea:!0}],v=[{key:"slug",label:"Slug"},{key:"title",label:"Title"},{key:"date",label:"Date (YYYY-MM-DD)"},{key:"teaser",label:"Teaser",textarea:!0},{key:"coverImage",label:"Cover Image"},{key:"tags",label:"Tags (comma-separated)"},{key:"body",label:"Body (Markdown)",textarea:!0}],w=[{key:"slug",label:"Slug"},{key:"artist",label:"Artist"},{key:"title",label:"Work Title"},{key:"price",label:"Price"},{key:"availability",label:"Availability (available|sold)"},{key:"image",label:"Image URL"},{key:"dims",label:"Dimensions"},{key:"year",label:"Year"}];return(t,l)=>{const e=ne,a=N;return c(),r("div",ie,[s("header",re,[l[2]||(l[2]=s("h1",{class:"text-2xl font-semibold"},"Admin Dashboard",-1)),s("div",ce,[s("input",{ref_key:"fileInput",ref:u,type:"file",class:"hidden",accept:"application/json",onChange:m},null,544),s("button",{class:"border rounded px-3 py-2",onClick:i},"Export JSON"),s("button",{class:"border rounded px-3 py-2",onClick:l[0]||(l[0]=()=>o(u)?.click())},"Import JSON"),s("button",{class:"border rounded px-3 py-2",onClick:l[1]||(l[1]=(..._)=>o(n)&&o(n)(..._))},"Logout")])]),y(a,null,{default:T(()=>[s("section",de,[y(e,{title:"Artists",collection:"artists",fields:b}),y(e,{title:"Exhibitions",collection:"exhibitions",fields:p}),y(e,{title:"The Window",collection:"window",fields:k}),y(e,{title:"Viewing Rooms",collection:"viewingRooms",fields:x}),y(e,{title:"Publications",collection:"publications",fields:h}),y(e,{title:"News",collection:"news",fields:v}),y(e,{title:"Studio",collection:"studio",fields:w})])]),_:1})])}}});export{pe as default};
