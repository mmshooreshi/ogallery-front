generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           Int      @id @default(autoincrement())
  email        String   @unique
  passwordHash String
  role         String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  mediaCreated Media[]
}

model Entry {
  id           Int           @id @default(autoincrement())
  kind         String
  slug         String
  status       Status        @default(DRAFT)
  dates        Json?
  props        Json?
  seo          Json?
  jsonld       Json?
  coverMediaId Int?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  deletedAt    DateTime?
  coverMedia   Media?        @relation("Entry_coverMedia", fields: [coverMediaId], references: [id])
  locales      EntryLocale[]
  media        EntryMedia[]
  tags         EntryTag[]
  linksFrom    Link[]        @relation("from")
  linksTo      Link[]        @relation("to")

  @@unique([kind, slug])
  @@index([kind, status])
  @@index([updatedAt])
}

model EntryLocale {
  id        Int      @id @default(autoincrement())
  entryId   Int
  locale    Locale
  slug      String?
  title     String?
  subtitle  String?
  summary   String?
  bodyHtml  String?
  seo       Json?
  jsonld    Json?
  data      Json?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  entry     Entry    @relation(fields: [entryId], references: [id])

  @@unique([entryId, locale])
}

model Media {
  id              Int          @id @default(autoincrement())
  url             String       @unique
  kind            String?
  mime            String?
  size            Int?
  width           Int?
  height          Int?
  durationMs      Int?
  alt             String?
  caption         String?
  credit          String?
  copyright       String?
  variants        Json?
  meta            Json?
  isPublic        Boolean      @default(true)
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
  createdById     Int?
  coverForEntries Entry[]      @relation("Entry_coverMedia")
  links           EntryMedia[]
  createdBy       User?        @relation(fields: [createdById], references: [id])
}

model EntryMedia {
  id      Int    @id @default(autoincrement())
  entryId Int
  mediaId Int
  role    String
  ord     Int?
  meta    Json?
  entry   Entry  @relation(fields: [entryId], references: [id])
  media   Media  @relation(fields: [mediaId], references: [id])

  @@unique([entryId, mediaId, role])
  @@index([entryId, role, ord])
  @@index([mediaId])
}

model Link {
  id     Int    @id @default(autoincrement())
  fromId Int
  toId   Int
  role   String
  ord    Int?
  from   Entry  @relation("from", fields: [fromId], references: [id])
  to     Entry  @relation("to", fields: [toId], references: [id])

  @@index([fromId, role, ord])
  @@index([toId, role, ord])
}

model Tag {
  id      Int        @id @default(autoincrement())
  slug    String
  name    String
  locale  Locale?
  entries EntryTag[]

  @@unique([slug, locale])
}

model EntryTag {
  entryId Int
  tagId   Int
  entry   Entry @relation(fields: [entryId], references: [id])
  tag     Tag   @relation(fields: [tagId], references: [id])

  @@id([entryId, tagId])
}

model UrlAlias {
  id        Int      @id @default(autoincrement())
  from      String   @unique
  to        String
  locale    Locale?
  createdAt DateTime @default(now())
}

enum Locale {
  EN
  FA
}

enum Status {
  DRAFT
  PUBLISHED
  ARCHIVED
}
